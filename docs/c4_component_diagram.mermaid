graph TB
    %% External Containers
    APILayer["ğŸŒ API Layer"]
    HRMModule["ğŸ§  HRM Module"] 
    MemorySystem["ğŸ’¾ Memory System"]
    ExecutionProviders["ğŸ”§ Execution Providers"]
    ModelLoader["ğŸ“¥ Model Loader"]
    
    subgraph "âš¡ Core Inference Engine"
        %% Core Components
        SessionManager["ğŸ­ Session Manager<br/>---<br/>â€¢ Session lifecycle<br/>â€¢ Context isolation<br/>â€¢ Resource management<br/>â€¢ Thread safety"]
        
        GraphOptimizer["ğŸ“Š Graph Optimizer<br/>---<br/>â€¢ Constant folding<br/>â€¢ Operator fusion<br/>â€¢ Dead code elimination<br/>â€¢ Memory layout optimization"]
        
        GraphPartitioner["ğŸ”€ Graph Partitioner<br/>---<br/>â€¢ Provider capability query<br/>â€¢ Subgraph assignment<br/>â€¢ Dependency analysis<br/>â€¢ Load balancing"]
        
        ExecutionPlanner["ğŸ“… Execution Planner<br/>---<br/>â€¢ Topological sorting<br/>â€¢ Parallelization strategy<br/>â€¢ Memory scheduling<br/>â€¢ Pipeline optimization"]
        
        KernelDispatcher["âš™ï¸ Kernel Dispatcher<br/>---<br/>â€¢ Operator routing<br/>â€¢ Kernel selection<br/>â€¢ Batching strategy<br/>â€¢ Error handling"]
        
        TensorManager["ğŸ§® Tensor Manager<br/>---<br/>â€¢ Memory allocation<br/>â€¢ Buffer pooling<br/>â€¢ Type conversion<br/>â€¢ Shape inference"]
        
        ThreadPool["ğŸ§µ Thread Pool<br/>---<br/>â€¢ Work stealing<br/>â€¢ NUMA awareness<br/>â€¢ Priority scheduling<br/>â€¢ Resource limits"]
        
        CacheManager["ğŸ’¨ Cache Manager<br/>---<br/>â€¢ Compiled graph cache<br/>â€¢ Kernel cache<br/>â€¢ Memory pattern cache<br/>â€¢ Eviction policies"]
        
        ProfilerService["â±ï¸ Profiler Service<br/>---<br/>â€¢ Execution timing<br/>â€¢ Memory profiling<br/>â€¢ Bottleneck detection<br/>â€¢ Performance metrics"]
        
        ErrorHandler["ğŸš¨ Error Handler<br/>---<br/>â€¢ Exception management<br/>â€¢ Graceful degradation<br/>â€¢ Recovery strategies<br/>â€¢ Diagnostic info"]
    end
    
    %% External Component Interactions
    APILayer -->|"CreateSession()<br/>Run()<br/>GetMetadata()"| SessionManager
    
    HRMModule -->|"Complex inference<br/>Multi-stage processing"| SessionManager
    MemorySystem -->|"Context retrieval<br/>Pattern matching"| SessionManager
    ModelLoader -->|"Model graphs<br/>Weight tensors"| SessionManager
    
    %% Internal Component Flow
    SessionManager -->|"Model graph<br/>Optimization request"| GraphOptimizer
    GraphOptimizer -->|"Optimized graph<br/>Transformation log"| GraphPartitioner
    GraphPartitioner -->|"Partitioned subgraphs<br/>Provider assignments"| ExecutionPlanner
    ExecutionPlanner -->|"Execution plan<br/>Resource requirements"| KernelDispatcher
    
    KernelDispatcher -->|"Kernel requests<br/>Operator dispatch"| ExecutionProviders
    KernelDispatcher -->|"Tensor allocation<br/>Buffer management"| TensorManager
    KernelDispatcher -->|"Parallel tasks<br/>Work distribution"| ThreadPool
    
    SessionManager -->|"Session state<br/>Compiled graphs"| CacheManager
    SessionManager -->|"Performance data<br/>Execution traces"| ProfilerService
    SessionManager -->|"Error events<br/>Exception context"| ErrorHandler
    
    %% Cross-cutting interactions
    TensorManager -->|"Memory statistics<br/>Allocation patterns"| ProfilerService
    ThreadPool -->|"Thread utilization<br/>Queue metrics"| ProfilerService
    ExecutionProviders -->|"Kernel performance<br/>Hardware metrics"| ProfilerService
    
    ErrorHandler -->|"Diagnostic data<br/>Error telemetry"| ProfilerService
    CacheManager -->|"Cache statistics<br/>Hit/miss ratios"| ProfilerService
    
    %% Performance feedback loops
    ProfilerService -.->|"Optimization hints<br/>Performance feedback"| GraphOptimizer
    ProfilerService -.->|"Load balancing data<br/>Bottleneck info"| GraphPartitioner
    
    %% Styling
    classDef external fill:#e3f2fd
    classDef session fill:#e8f5e8
    classDef optimization fill:#fff3e0
    classDef execution fill:#f3e5f5
    classDef resource fill:#e0f2f1
    classDef observability fill:#fce4ec
    classDef error fill:#ffebee
    
    class APILayer,HRMModule,MemorySystem,ExecutionProviders,ModelLoader external
    class SessionManager session
    class GraphOptimizer,GraphPartitioner optimization
    class ExecutionPlanner,KernelDispatcher execution
    class TensorManager,ThreadPool,CacheManager resource
    class ProfilerService observability
    class ErrorHandler error